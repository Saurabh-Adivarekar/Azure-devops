trigger:
  - master

pool:
  vmImage: 'ubuntu-latest'

jobs:
  - job: A
    steps:
      - script: echo "Pipeline to build, push and deploy application"
        displayName: 'Run an Azure pipeline'

      - task: Docker@2
        inputs:
          containerRegistry: 'saurabh'
          repository: 'saurabhDemoRegistry'
          command: 'buildAndPush'
          Dockerfile: './Dockerfile'
          buildContext: '.'
          tags: 'mynginx'

  - job: B
    dependsOn: A
    steps:
        - task: SSH@0
          inputs:
            sshEndpoint: 'azuredemopipelineconnection'
            runOptions: 'commands'
            commands: |
              az acr login --name saurabhdemoregistry
              docker pull saurabhdemoregistry.azurecr.io/mynginx:sha256:1be1f3afef6c13295b59ea61837c0cb9d9b75a9e381aba5e3dd15b662a1fe0e8
              docker run -d -p 80:80 --name mynginx-con saurabhdemoregistry.azurecr.io/mynginx:sha256:1be1f3afef6c13295b59ea61837c0cb9d9b75a9e381aba5e3dd15b662a1fe0e8
            readyTimeout: '20000'


      


